Vamos implementar agora os 3 estados deste jogo. Copie o c&oacute;digo seguinte para o arquivo Estados.h. <br>
<br>
<center><table width='90%' cellspacing='0' cellpadding='0' bgcolor='#EEEEEE'><tr><td><font face='arial' color='#000000' size='1'>
#ifndef&nbsp;ESTADOS_H<br>
#define&nbsp;ESTADOS_H<br>
<br>
class&nbsp;EstadoApresentacao&nbsp;:&nbsp;public&nbsp;Estado<br>
{<br>
&nbsp;&nbsp;private:<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Inst&acirc;ncia&nbsp;&uacute;nica&nbsp;da&nbsp;classe&nbsp;(Singleton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;EstadoApresentacao*&nbsp;m_pInstancia;<br>
&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Cria&nbsp;a&nbsp;inst&acirc;ncia&nbsp;&uacute;nica&nbsp;da&nbsp;classe&nbsp;(Singleton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;EstadoApresentacao*&nbsp;CriaInstancia();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoEntrar();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;ExecutaFrame();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoSair();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Eventos&nbsp;de&nbsp;mudan&ccedil;a&nbsp;de&nbsp;estado<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoTerminarTempo(Maquina*&nbsp;maquina);<br>
};<br>
<br>
class&nbsp;EstadoMenu&nbsp;:&nbsp;public&nbsp;Estado<br>
{<br>
&nbsp;&nbsp;private:<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Inst&acirc;ncia&nbsp;&uacute;nica&nbsp;da&nbsp;classe&nbsp;(Singleton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;EstadoMenu*&nbsp;m_pInstancia;<br>
&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Cria&nbsp;a&nbsp;inst&acirc;ncia&nbsp;&uacute;nica&nbsp;da&nbsp;classe&nbsp;(Singleton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;EstadoMenu*&nbsp;CriaInstancia();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoEntrar();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;ExecutaFrame();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoSair();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Eventos&nbsp;de&nbsp;mudan&ccedil;a&nbsp;de&nbsp;estado<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoPressionarJogar(Maquina*&nbsp;maquina);<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoPressionarSair(Maquina*&nbsp;maquina);<br>
};<br>
<br>
class&nbsp;EstadoJogo&nbsp;:&nbsp;public&nbsp;Estado<br>
{<br>
&nbsp;&nbsp;private:<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Inst&acirc;ncia&nbsp;&uacute;nica&nbsp;da&nbsp;classe&nbsp;(Singleton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;EstadoJogo*&nbsp;m_pInstancia;<br>
&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Cria&nbsp;a&nbsp;inst&acirc;ncia&nbsp;&uacute;nica&nbsp;da&nbsp;classe&nbsp;(Singleton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;EstadoJogo*&nbsp;CriaInstancia();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoEntrar();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;ExecutaFrame();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoSair();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Eventos&nbsp;de&nbsp;mudan&ccedil;a&nbsp;de&nbsp;estado<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;AoPressionarESC(Maquina*&nbsp;maquina);<br>
};<br>
<br>
#endif&nbsp;&nbsp;<br>
</font></td></tr></table></center><br>
<br>
Como voc&ecirc; pode visualizar no c&oacute;digo, todos os meus estados s&atilde;o um Singleton, isso &eacute; recomenda&ccedil;&atilde;o do Erich Gamma em seu livro. Portanto, os 3 estados ter&atilde;o os m&eacute;todos e atributos referentes ao padr&atilde;o Singleton. O m&eacute;todo &eacute; o CriaInstancia() e o atributo &eacute; o m_pInstancia. Voc&ecirc; pode notar que todos os estados possuem esse m&eacute;todo e esse atributo. <br>
<br>
Em seguida temos a declara&ccedil;&atilde;o dos 3 m&eacute;todos que foram declarados abstratos na classe Estado: AoSair(), ExecutarFrame() e AoEntrar(). Cada um desses m&eacute;todos j&aacute; foram explicados anteriormente, mas o que vou acrescentar &eacute; que cada um dos estados possui uma l&oacute;gica sua de sequ&ecirc;ncia de tarefas que eles v&atilde;o executar, ou seja, a l&oacute;gica &eacute; espec&iacute;fica para cada estado. Eu mostrarei isso na implementa&ccedil;&atilde;o do estado. <br>
<br>
Ap&oacute;s declarar os m&eacute;todos acima, encontramos os eventos da m&aacute;quina tratados por um estado espec&iacute;fico. Os estados n&atilde;o implementam todos os eventos e sim somente aqueles que ele ir&aacute; ser capaz de tratar. Por isso que no primeiro estado, voc&ecirc; encontra o m&eacute;todo AoTerminarTempo() e nos outros estados n&atilde;o. Esse m&eacute;todo s&oacute; &eacute; necess&aacute;rio no estado apresenta&ccedil;&atilde;o de acordo com as defini&ccedil;&otilde;es de nosso projeto. Isso vale para os outros estados tamb&eacute;m, voc&ecirc; ver&aacute; que cada um implementa os eventos necess&aacute;rios para ele. <br>
<br>
Agora, observe a implementa&ccedil;&atilde;o da classe acima. Acrescente o c&oacute;digo abaixo no arquivo Estados.cpp: <br>
<br>
<center><table width='90%' cellspacing='0' cellpadding='0' bgcolor='#EEEEEE'><tr><td><font face='arial' color='#000000' size='1'>
#include&nbsp;&quot;Global.h&quot;<br>
<br>
EstadoApresentacao*&nbsp;EstadoApresentacao::m_pInstancia&nbsp;=&nbsp;0;<br>
<br>
EstadoApresentacao*&nbsp;EstadoApresentacao::CriaInstancia()<br>
{<br>
&nbsp;&nbsp;if(m_pInstancia&nbsp;==&nbsp;0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;m_pInstancia&nbsp;=&nbsp;new&nbsp;EstadoApresentacao();<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;return&nbsp;m_pInstancia;<br>
}<br>
<br>
void&nbsp;EstadoApresentacao::AoEntrar()<br>
{<br>
}<br>
<br>
void&nbsp;EstadoApresentacao::ExecutaFrame()<br>
{<br>
&nbsp;&nbsp;printf(&quot;&nbsp;Apresentacao&nbsp;&quot;);<br>
}<br>
<br>
void&nbsp;EstadoApresentacao::AoSair()<br>
{<br>
}<br>
<br>
void&nbsp;EstadoApresentacao::AoTerminarTempo(Maquina*&nbsp;maquina)<br>
{<br>
&nbsp;&nbsp;ExecutaTransicao(maquina,&nbsp;EstadoMenu::CriaInstancia());<br>
}<br>
<br>
EstadoMenu*&nbsp;EstadoMenu::m_pInstancia&nbsp;=&nbsp;0;<br>
<br>
EstadoMenu*&nbsp;EstadoMenu::CriaInstancia()<br>
{<br>
&nbsp;&nbsp;if(m_pInstancia&nbsp;==&nbsp;0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;m_pInstancia&nbsp;=&nbsp;new&nbsp;EstadoMenu();<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;return&nbsp;m_pInstancia;<br>
}<br>
<br>
void&nbsp;EstadoMenu::AoEntrar()<br>
{<br>
}<br>
<br>
void&nbsp;EstadoMenu::ExecutaFrame()<br>
{<br>
&nbsp;&nbsp;printf(&quot;&nbsp;Menu&nbsp;&quot;);<br>
&nbsp;&nbsp;printf(&quot;&nbsp;-&nbsp;Pressione&nbsp;'j'&nbsp;para&nbsp;jogar&quot;);<br>
&nbsp;&nbsp;printf(&quot;&nbsp;-&nbsp;Pressione&nbsp;'q'&nbsp;para&nbsp;sair&nbsp;&quot;);<br>
}<br>
<br>
void&nbsp;EstadoMenu::AoSair()<br>
{<br>
}<br>
<br>
void&nbsp;EstadoMenu::AoPressionarSair(Maquina*&nbsp;maquina)<br>
{<br>
&nbsp;&nbsp;maquina-&gt;Finalizar();<br>
}<br>
<br>
void&nbsp;EstadoMenu::AoPressionarJogar(Maquina*&nbsp;maquina)<br>
{<br>
&nbsp;&nbsp;ExecutaTransicao(maquina,&nbsp;EstadoJogo::CriaInstancia());<br>
}<br>
<br>
EstadoJogo*&nbsp;EstadoJogo::m_pInstancia&nbsp;=&nbsp;0;<br>
<br>
EstadoJogo*&nbsp;EstadoJogo::CriaInstancia()<br>
{<br>
&nbsp;&nbsp;if(m_pInstancia&nbsp;==&nbsp;0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;m_pInstancia&nbsp;=&nbsp;new&nbsp;EstadoJogo();<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;return&nbsp;m_pInstancia;<br>
}<br>
<br>
void&nbsp;EstadoJogo::AoEntrar()<br>
{<br>
}<br>
<br>
void&nbsp;EstadoJogo::ExecutaFrame()<br>
{<br>
&nbsp;&nbsp;printf(&quot;&nbsp;Jogo&nbsp;&quot;);<br>
&nbsp;&nbsp;printf(&quot;&nbsp;Pressione&nbsp;'ESC'&nbsp;para&nbsp;sair&quot;);<br>
}<br>
<br>
void&nbsp;EstadoJogo::AoSair()<br>
{<br>
}<br>
<br>
void&nbsp;EstadoJogo::AoPressionarESC(Maquina*&nbsp;maquina)<br>
{<br>
&nbsp;&nbsp;ExecutaTransicao(maquina,&nbsp;EstadoMenu::CriaInstancia());<br>
}&nbsp;&nbsp;<br>
</font></td></tr></table></center><br>
<br>
No c&oacute;digo acima, n&oacute;s vemos o padr&atilde;o Singleton implementado para cada um dos estados (j&aacute; foi explicado anteriormente). Em seguida, n&atilde;o precisei implementar c&oacute;digo para os eventos AoSair() e AoEntrar(), pois a simplicidade do meu projeto n&atilde;o exige inicializa&ccedil;&atilde;o de objetos nos estados, ao contr&aacute;rio do m&eacute;todo ExecutaFrame(). Esse &uacute;ltimo necessita de um c&oacute;digo espec&iacute;fico, pois aqui eu imprimo a mensagem que indica na tela qual estado est&aacute; rodando nesse momento. <br>
<br>
Em seguida, n&oacute;s encontraremos a implementa&ccedil;&atilde;o dos eventos. Basicamente, nesse tutorial, a l&oacute;gica da transi&ccedil;&atilde;o de um estado &eacute; simplesmente passar a inst&acirc;ncia da m&aacute;quina e a inst&acirc;ncia do novo estado. O m&eacute;todo ExecutaTransicao() implementado na classe Estado pai &eacute; ent&atilde;o chamado recebendo a m&aacute;quina e o novo estado. Ele chama ent&atilde;o, o m&eacute;todo ExecutaTransicao() da m&aacute;quina recebendo a inst&acirc;ncia do novo estado. Esse m&eacute;todo pegar&aacute; essa inst&acirc;ncia e indicar&aacute; que o seu atributo m_pEstadoAtual ir&aacute; receber a refer&ecirc;ncia para essa inst&acirc;ncia. Dessa forma, o estado atual muda e a m&aacute;quina assume um novo estado concreto. <br>
<br>
Se voc&ecirc; quiser fazer o download do projeto com o c&oacute;digo fonte completo deste tutorial no Codeblocks <a href='/schifers/files/tutorialCodeblocks.zip'>clique aqui</a>.<br>
<br>
Se voc&ecirc; preferis fazer o download do projeto para o Dev-C++ <a href='/schifers/files/tutorial.zip'>clique aqui</a>. <br>
<br>
Com isso, n&oacute;s terminamos mais um tutorial da Schifer. Se voc&ecirc; seguiu o tutorial inteiro e gostou ou n&atilde;o gostou do que leu, tem d&uacute;vidas sobre o que leu, ou quer apenas me mandar uma mensagem, sinta-se livre para me enviar um e-mail. Meu e-mail &eacute; <a href='mailto:schifers@hotmail.com'>schifers@hotmail.com</a>. Agrade&ccedil;o a aten&ccedil;&atilde;o e espero que voc&ecirc;s tenham entendido tudo o que foi explicado aqui. <br>
<br>
Um abra&ccedil;o a todos e at&eacute; o pr&oacute;ximo tutorial. <br>
<br>
Bruno Schifer <br>
<br>
 